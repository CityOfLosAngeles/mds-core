suite: test cronjob metrics sheet
templates:
  - cronjob.yaml
tests:
  - it: all
    release:
      namespace: mds
    values:
      - ./cronjob-values-metrics-sheet.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isAPIVersion:
          of: batch/v1beta1
      - isKind:
          of: CronJob
      - equal:
          path: metadata.name
          value: metrics-sheet
      - equal:
          path: metadata.namespace
          value: mds
      - equal:
          path: spec.schedule
          value: |-
            */1 * * * *
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].name
          value: metrics-sheet
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].image
          value: busybox
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[0].name
          value: AUDIENCE
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[0].value
          value: audience-stub
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[1].name
          value: AUTH0_DOMAIN
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[1].value
          value: auth0-domain-stub
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[2].name
          value: CLIENT_ID
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[2].value
          value: client-id-stub
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[3].name
          value: CLIENT_SECRET
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[3].valueFrom.secretKeyRef.key
          value: CLIENT_SECRET
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[3].valueFrom.secretKeyRef.name
          value: metrics-sheet
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[4].name
          value: GOOGLE_CLIENT_EMAIL
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[4].value
          value: google-client-email-stub
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[5].name
          value: GOOGLE_PRIVATE_KEY
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[5].valueFrom.secretKeyRef.key
          value: GOOGLE_PRIVATE_KEY
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].env[5].valueFrom.secretKeyRef.name
          value: metrics-sheet
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].restartPolicy
          value: OnFailure
