suite: test certificate management default
templates:
  - cert-manager.yaml
tests:
  - it: doc 0
    release:
      namespace: mds
    set:
      tls:
        enabled: true
        domain: tls-domain
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Certificate
      - equal:
          path: metadata.name
          value: ingress-cert
      - equal:
          path: metadata.namespace
          value: istio-system
      - equal:
          path: spec.secretName
          value: ingress-cert
      - equal:
          path: spec.issuerRef.name
          value: letsencrypt-staging
      - equal:
          path: spec.issuerRef.kind
          value: ClusterIssuer
      - equal:
          path: spec.commonName
          value: tls-domain
      - equal:
          path: spec.dnsNames[0]
          value: tls-domain
      - equal:
          path: spec.acme.config[0].http01.ingressClass
          value: istio
      - equal:
          path: spec.acme.config[0].domains[0]
          value: tls-domain