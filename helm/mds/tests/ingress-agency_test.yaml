suite: test ingress agency
templates:
  - ingress.yaml
tests:
  - it: doc 1
    release:
      namespace: mds
    asserts:
      - isAPIVersion:
          of: extensions/v1beta1
        documentIndex: 1
      - isKind:
          of: Ingress
        documentIndex: 1
      - equal:
          path: metadata.annotations.kubernetes\.io/ingress\.class
          value: istio
        documentIndex: 1
      - equal:
          path: metadata.name
          value: mds-agency-ingress
        documentIndex: 1
      - equal:
          path: metadata.namespace
          value: mds
        documentIndex: 1
      - isNull:
          path: spec.rules[0].host
        documentIndex: 1
      - equal:
          path: spec.rules[0].http.paths[0].path
          value: /agency
        documentIndex: 1
      - equal:
          path: spec.rules[0].http.paths[0].backend.serviceName
          value: mds-agency
        documentIndex: 1
      - equal:
          path: spec.rules[0].http.paths[0].backend.servicePort
          value: 4001
        documentIndex: 1
      - equal:
          path: spec.rules[0].http.paths[1].path
          value: /agency/*
        documentIndex: 1
      - equal:
          path: spec.rules[0].http.paths[1].backend.serviceName
          value: mds-agency
        documentIndex: 1
      - equal:
          path: spec.rules[0].http.paths[1].backend.servicePort
          value: 4001
        documentIndex: 1